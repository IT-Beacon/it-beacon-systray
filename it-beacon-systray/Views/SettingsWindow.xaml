<Window x:Class="it_beacon_systray.Views.SettingsWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:it_beacon_systray.Views"
        xmlns:helpers="clr-namespace:it_beacon_systray.Helpers"
        mc:Ignorable="d"
        Title="Application Settings" 
        Height="450" Width="650"
        MinWidth="500" MinHeight="350"
        WindowStartupLocation="CenterScreen"
        ShowInTaskbar="True"
        ResizeMode="CanResizeWithGrip"
        Style="{StaticResource PopupWindowStyle}"
        Background="{DynamicResource PopupBackgroundBrush}"
        Foreground="{DynamicResource PopupForegroundBrush}">

    <Window.Resources>
        <helpers:StringToBooleanConverter x:Key="StringToBooleanConverter"/>
        <helpers:InvertBooleanConverter x:Key="InvertBooleanConverter"/>

        <Style x:Key="SettingTextBoxStyle" TargetType="TextBox">
            <Setter Property="Padding" Value="5,3"/>
            <Setter Property="Background" Value="{DynamicResource PopupBackgroundBrush}"/>
            <Setter Property="Foreground" Value="{DynamicResource PopupForegroundBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PopupBorderBrush}"/>
            <Setter Property="VerticalContentAlignment" Value="Center"/>
            <Setter Property="Validation.ErrorTemplate" Value="{x:Null}"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                </Trigger>
                <Trigger Property="IsFocused" Value="True">
                    <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                    <Setter Property="Background" Value="{DynamicResource PopupBackgroundBrush}"/>
                </Trigger>
                <Trigger Property="IsReadOnly" Value="True">
                    <Setter Property="Background" Value="Transparent"/>
                    <Setter Property="Opacity" Value="0.6"/>
                    <Setter Property="BorderBrush" Value="Transparent"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <DataTemplate x:Key="SettingTextTemplate">
            <TextBox Text="{Binding Value, UpdateSourceTrigger=PropertyChanged}"
                     IsReadOnly="{Binding IsReadOnly}"
                     Style="{StaticResource SettingTextBoxStyle}"/>
        </DataTemplate>

        <DataTemplate x:Key="SettingCheckBoxTemplate">
            <CheckBox IsChecked="{Binding Value, Converter={StaticResource StringToBooleanConverter}, UpdateSourceTrigger=PropertyChanged}"
                      IsEnabled="{Binding IsReadOnly, Converter={StaticResource InvertBooleanConverter}}"
                      VerticalAlignment="Center"/>
        </DataTemplate>

        <helpers:SettingTemplateSelector x:Key="SettingTemplateSelector"
                                         TextTemplate="{StaticResource SettingTextTemplate}"
                                         CheckBoxTemplate="{StaticResource SettingCheckBoxTemplate}"/>

        <Style x:Key="CategoryListStyle" TargetType="ListBox">
            <Setter Property="Background" Value="{DynamicResource FooterBackgroundBrush}" />
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="ItemContainerStyle" Value="{DynamicResource CategoryItemStyle}"/>
        </Style>

        <Style x:Key="CategoryItemStyle" TargetType="ListBoxItem">
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Margin" Value="5,2"/>
            <Setter Property="Foreground" Value="{DynamicResource PopupForegroundBrush}"/>
            <Setter Property="Opacity" Value="0.8"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="border"
                                Background="Transparent"
                                BorderBrush="Transparent"
                                BorderThickness="2,0,0,0"
                                Padding="{TemplateBinding Padding}"
                                Margin="{TemplateBinding Margin}"
                                CornerRadius="4">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentHoverBrush}"/>
                                <Setter Property="Opacity" Value="1"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="border" Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                                <Setter TargetName="border" Property="Background" Value="{DynamicResource AccentHoverBrush}"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter Property="Opacity" Value="1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="15,5"/>
            <Setter Property="MinWidth" Value="80"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Background" Value="{DynamicResource AccentBrush}"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource AccentHoverBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="{DynamicResource PopupBorderBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource PopupForegroundBrush}"/>
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <Style x:Key="CancelButtonStyle" TargetType="Button">
            <Setter Property="Padding" Value="15,5"/>
            <Setter Property="MinWidth" Value="80"/>
            <Setter Property="Margin" Value="5,0"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{DynamicResource PopupForegroundBrush}"/>
            <Setter Property="BorderBrush" Value="{DynamicResource PopupBorderBrush}"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}"
                                BorderBrush="{TemplateBinding BorderBrush}"
                                BorderThickness="{TemplateBinding BorderThickness}"
                                CornerRadius="4">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="{DynamicResource FooterBackgroundBrush}"/>
                                <Setter Property="BorderBrush" Value="{DynamicResource AccentBrush}"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Background" Value="{DynamicResource PopupBorderBrush}"/>
                                <Setter Property="Foreground" Value="{DynamicResource PopupForegroundBrush}"/>
                                <Setter Property="Opacity" Value="0.5"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="180" MinWidth="150"/>
            <ColumnDefinition Width="Auto" />
            <ColumnDefinition Width="*" />
        </Grid.ColumnDefinitions>

        <Border Grid.Column="0" 
                Background="{DynamicResource FooterBackgroundBrush}"
                BorderBrush="{DynamicResource PopupBorderBrush}"
                BorderThickness="0,0,1,0">
            <DockPanel Margin="5">
                <TextBlock DockPanel.Dock="Top" 
                           Text="Categories" 
                           FontWeight="SemiBold" 
                           Opacity="0.7"
                           Margin="10,10,10,5"/>
                <TextBlock DockPanel.Dock="Bottom"
                           x:Name="VersionLabel"
                           Opacity="0.6"
                           Margin="10,5"
                           FontSize="11"/>
                <ListBox x:Name="CategoryListBox"
                         Style="{StaticResource CategoryListStyle}"
                         SelectionChanged="CategoryListBox_SelectionChanged"
                         ItemsSource="{Binding Categories}"/>
            </DockPanel>
        </Border>

        <GridSplitter Grid.Column="1" 
                      Width="5" 
                      HorizontalAlignment="Center" 
                      VerticalAlignment="Stretch"
                      Background="{DynamicResource PopupBorderBrush}"
                      Opacity="0.5"/>

        <Border Grid.Column="2" 
                Background="{DynamicResource PopupBackgroundBrush}"
                Padding="15">
            <DockPanel>
                <TextBlock DockPanel.Dock="Top" 
                           x:Name="SettingsHeader"
                           Text="Loaded Configuration" 
                           FontSize="18" FontWeight="SemiBold" 
                           Margin="0,0,0,15"/>

                <StackPanel DockPanel.Dock="Bottom" 
                            Orientation="Horizontal" 
                            HorizontalAlignment="Right"
                            Margin="0,15,0,0">
                    <Button x:Name="OkButton" 
                            Content="OK" 
                            Style="{StaticResource ActionButtonStyle}"
                            Click="OkButton_Click"/>
                    <Button x:Name="CancelButton" 
                            Content="Cancel" 
                            Style="{StaticResource CancelButtonStyle}"
                            Click="CancelButton_Click"/>
                    <Button x:Name="ApplyButton" 
                            Content="Apply" 
                            Style="{StaticResource ActionButtonStyle}"
                            Click="ApplyButton_Click"/>
                </StackPanel>

                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled">
                    <ItemsControl ItemsSource="{Binding FilteredSettings}"
                                  Foreground="{DynamicResource PopupForegroundBrush}">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Grid Margin="0,0,0,10">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="160"/>
                                        <ColumnDefinition Width="*"/>
                                    </Grid.ColumnDefinitions>

                                    <TextBlock Grid.Column="0" 
                                               Text="{Binding Key}" 
                                               FontWeight="SemiBold"
                                               Opacity="0.8"
                                               VerticalAlignment="Center"
                                               Margin="0,0,10,0"
                                               TextTrimming="CharacterEllipsis"/>

                                    <ContentPresenter Grid.Column="1"
                                                      Content="{Binding}"
                                                      ContentTemplateSelector="{StaticResource SettingTemplateSelector}"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>

            </DockPanel>
        </Border>
    </Grid>
</Window>